/*
Find the question here:https://adventofcode.com/2022/day/2

PART ONE-What would your total score be if everything goes exactly according to your strategy guide?
PART TWO-Following the Elf's instructions for the second column, what would your total score be if everything goes exactly according to your strategy guide?
*/

--table storing input
create table input_rps_quest (
  input clob
);

declare 
input_rps_quest clob := q'!A X
B X
C X
C Y
B Y
C Z
C X
C Y
C Y
B Y
B Y
C Z
C Y
A Y
B Z
B Z
C Y
B Z
A Y
C Y
B Y
C Y
B Y
B X
A Y
A Y
C Y
B X
C X
B Y
A Y
C Z
C X
B Y
B Y
A Y
C X
B Y
B Y
B Z
B Y
A X
C Y
A Y
B X
C Y
A Y
C X
A Z
A X
C Y
A Y
A Y
B Z
B Y
A Y
C Y
B Z
C Y
A Y
A Y
C Y
B Y
B X
B X
C Y
B Y
B X
A X
B Z
A X
B Y
A Y
B Z
B X
B Y
A Y
C X
C Y
C Y
A Y
A Z
C Z
A Y
B Z
C Y
A Y
C X
C Z
B Z
B Y
B Y
A Y
C Z
C Y
B Y
A Z
A Y
A Z
A Y
A Y
A Y
A Y
C Y
B Y
B Y
A Z
A Y
A Y
A X
B Z
C Y
A Y
B Y
B Y
A Y
A Y
B Y
B Y
C X
C Y
B Z
C Y
C Y
B Y
B Z
C X
A X
A X
A Z
B Y
B Z
C Y
C Y
C Y
A Y
C X
B X
B Y
B Y
C Y
C Z
C Y
A Y
C Y
B Z
C X
B Y
A Y
C Y
C Y
C Z
B X
B Y
B Y
A Y
C Z
C Y
B Y
C Y
B Z
C Y
A Y
B Y
B Z
C X
A Y
B Y
B Y
C Z
A Y
C Y
A X
B Y
B Y
B Y
B Z
B X
C Y
B X
C Z
B Y
B Y
C Y
B Y
B Z
A X
C Z
B Y
C Y
C Y
C X
C X
A Y
C Y
B Z
C Y
B Y
C Z
B X
A X
A Y
B Y
C Z
C Z
C Y
B X
B X
B X
B Y
B X
C Y
C Y
B X
B Y
B Z
B Z
C Y
C Y
A Y
B Y
B Y
B Y
B Y
B X
A Y
B Y
C Z
B Z
C Y
B Y
B Y
B X
A Y
C Z
C Y
C Y
C Y
C Z
C Y
B X
C X
C Z
B X
B Y
A Y
C Y
A Y
B Y
B X
C X
C X
C Y
C Y
C Y
B Y
C Y
A Y
B Y
A Y
C Z
B Y
C Y
A Y
B Y
A Y
A Y
B X
B Y
B Y
A X
C X
B X
C Y
A Y
B Y
A Y
C Z
B Y
C Z
B Z
B Y
A Y
C Y
C X
B X
C Y
A Z
A X
B Z
A Y
B X
C Y
C Y
C Y
A Y
C Z
A X
B Z
C Y
B Y
B Y
B Y
C Y
A Y
C X
B X
B X
C Y
B Z
C Y
B X
C Y
B Y
A Y
C Y
B Z
A Y
A Y
C Y
B Y
B X
A Y
C Z
B Y
C Z
B X
B Y
A Y
C Z
C Y
C Y
B Y
C Y
B X
C Y
B Y
B X
C Y
B X
A X
B Y
A Z
C Y
A Y
B Y
B X
C Y
B X
C Y
C Y
B Y
C Y
C Y
B X
B X
C Y
A Y
B X
C Y
B Y
A Y
B X
B Y
A Y
A Z
A Y
C Y
A X
B Y
C Z
B Y
A Y
B Y
A X
C X
B Y
A Y
A Y
B Y
B Y
B Y
A Y
B Z
C X
A Y
B X
B Y
A Z
B Z
A X
B Y
C X
C X
A Y
B Y
C Y
B Z
B Y
A Z
C Z
A Y
A Y
A X
B Y
B Y
C X
A Y
C Z
A Y
A Y
B Y
A Y
B Z
B Y
B X
C X
C Y
A Y
B Z
A Y
B Y
A Y
A Y
C Y
A X
C Y
B X
B X
B Y
B X
B Z
B Y
C Y
C Y
C Z
B Z
A Z
B Y
C Y
C Y
C Y
B Y
A Y
B Z
C Y
C Z
B Y
B Y
B Y
B Y
C X
B Z
A Y
A Y
B Y
B X
B Y
B X
A Y
C Y
B X
B Y
C Y
B Y
C Y
C Y
C X
B Y
B X
C Z
B Y
A Y
B X
C Y
A Z
C Y
C X
B Y
C Z
C Y
B X
C Y
A Y
A X
B X
C X
A Y
C Z
C Y
B Y
B X
C Y
B X
B Z
B Z
B Y
B Z
B X
C Y
C Y
B Y
B Y
C Y
B Y
B Y
B Z
B Y
A X
B Y
C X
B Y
A X
C Y
B Y
A Y
B Z
B Z
A Y
A X
C Y
B Y
B Y
C X
A Y
C Y
B Y
C Z
B X
A Y
A Y
B Z
A Y
B X
B X
C Y
A X
B X
B X
B Y
B Y
B Y
B Z
A Y
C Y
A Y
C Y
A Z
C X
B Y
C Y
B Y
C Y
B X
B Z
A X
A Y
C Y
C Y
B Y
A Y
A Y
A Y
A Y
A Y
C Y
C X
B Y
B Z
B Z
B Y
B Z
B Z
B X
A Y
B Z
B Y
C Z
B Y
C Z
A Z
C Y
C X
B Y
B Y
B Y
A Z
C Y
A Y
B Y
A Y
A Y
A X
B Y
B Z
B X
A X
C Z
B X
C Y
B X
B Y
B X
A Y
B X
B Y
C Z
C Y
C X
B Y
B Y
A X
C Y
B Y
A Y
C Y
C X
B Z
C Y
A Y
C X
B Y
C Y
C X
C X
C Z
C Y
C X
A Y
C Y
C Y
B X
B X
B Y
C Z
B Y
B Z
B Y
C Y
B X
A Y
B Y
B Y
B X
B Y
B Y
C Y
B Z
B Y
C X
A Y
A Y
C Y
C Z
B Y
B X
C Y
C Y
C Y
A Y
C X
A Y
B Y
B X
A Y
B Y
C Y
B X
C Y
B Y
A Y
A Z
C Y
B Y
C Y
A Y
B X
B X
B Y
C Y
B X
B Y
C Z
C Y
C Y
A Y
C Y
B Z
B Z
B Y
C Y
C Z
A X
B Y
B Z
C Z
B X
A Y
A X
B X
B X
A Z
B X
C Y
C Y
B Y
C Y
B Y
A Y
B Y
C X
B Z
C X
B X
C X
B Y
C Y
C Y
B Y
B Y
C Y
C X
B X
A Y
C Y
A X
B Y
B Y
B Y
C Y
B Z
C Y
C Z
B X
C Y
A Y
B Y
A Y
C Y
A Z
B Z
B Y
A Y
B Z
B Y
C X
B Y
C Y
C Y
A Y
C Y
A Y
B Y
C Z
C X
C Y
C X
B X
B Y
C Z
A Y
C Y
C Z
C Y
C Y
C Y
B Y
B Z
B Y
C Y
C Z
B Z
C Y
C X
A Z
B Y
A Y
B Y
B Y
A X
C Z
C Y
B Y
B Y
C Y
C Y
B Y
C Y
C Y
B X
B Y
C X
B X
B Y
C X
C Y
B Z
C X
C X
B Y
A Y
B Y
C Y
B X
A Y
C Y
C X
C X
A Z
B Z
A Y
C Y
C Y
A X
A Y
B Y
B Y
C Y
C Y
C Y
C Z
B Y
C Y
A Y
B X
C Z
A Y
C X
B Y
B Y
B Y
C Z
B Y
C Y
B Y
B X
C Y
C Y
A Y
B Y
B Y
B X
B Y
B Z
B Y
A X
C Y
B X
B Y
B X
B Y
B Y
C Y
C Y
C Y
B Y
B Y
B X
A Y
C Z
B X
B X
C X
C Y
A Y
B Y
B Y
C Y
C Y
C Z
A X
B X
A X
A Z
A X
C Y
C Y
A X
B Y
C Z
B X
C Y
B X
B Y
B Y
B X
C Y
B X
A Y
B Y
B Y
B X
B Y
C Y
B Y
B Y
C Y
C Y
B X
C Y
B X
C Y
C Y
C Z
C Y
B X
B Y
A Y
C Y
A Y
B Y
C Y
C Y
B X
B Y
B Y
A Y
B Y
A Y
B X
A X
C X
B Y
A Z
A Y
B X
B X
A Y
B X
B X
C X
C X
B X
B Z
C Z
A Y
B X
B Y
B Z
C Y
C Y
C Y
A Z
B X
B Z
B X
B Y
B Z
B Y
B Z
C Y
B Y
C X
C Y
B X
C Z
A Z
A X
B Y
C Y
A Y
C Y
A Y
A X
C Y
B Y
B Y
A Y
C Y
C X
B Z
B Y
B Z
C Y
A Y
C X
A Y
C Y
C Y
B X
C Y
A Y
C Y
C X
B Y
B Z
A Y
B X
A X
A Y
C Y
B Y
A Y
B Y
C Y
C Z
B X
A Y
A Y
A Y
A Z
A Y
B Y
C Y
C Y
B Z
B X
C Y
A Y
B X
B Y
B X
C Y
B Y
A X
C X
C Y
B X
B Y
B Z
B X
B Y
A Y
B X
B Z
C Y
A Y
C X
C Z
C X
A Z
B Z
B Y
C X
B X
C Y
B Y
A Y
C X
A Y
B X
B Y
C Y
B Y
C Y
B Z
B X
A Y
A X
C Y
C Y
B Y
B Y
B Y
B Y
C Z
A X
C Y
C Y
B Y
B Z
C Z
A Y
B X
C Y
C Y
B Z
B Y
B Y
B X
B Z
B Y
C Y
C Y
C Y
B Y
A X
A Y
C Y
A Y
A X
A Y
C Y
B X
C Y
C X
B Y
B Y
C Z
C Z
B Y
B Y
C X
C Y
B Z
A Y
C X
B X
C Y
B Y
B Z
A Y
B Z
B X
B Y
A Y
B Y
C Z
A Y
B X
A Y
B Y
B X
A Y
C Y
A Y
B Z
B Z
B Y
A X
A Y
C Z
B Y
B Z
C Y
B Y
B X
B Z
B Y
A X
A Y
C Z
C Y
A Z
B Z
B X
B X
B Y
C Y
B Y
C Y
B Y
B Z
C Z
B X
A Y
C Y
C Y
C Y
C X
C Y
A Y
B X
A Y
B X
A Y
C Y
A Y
B Y
B Y
C Z
B Y
C Y
C Y
B Z
A Y
C Y
B Y
B Y
C Y
C Z
B X
A Y
C X
C Y
B Y
B X
A Y
B Y
A Y
A X
C X
C Y
C Y
A Y
B Y
A Y
A Y
A Y
B X
B Z
C Z
C Z
B X
C Y
B X
C Y
B X
C Y
C Y
C Y
B X
B Y
A Z
C Y
B X
C Y
B Y
B Y
C Y
A Y
C Y
B X
B Y
A X
C Y
C Y
B Y
B X
B Z
C Z
A Y
A Y
B Y
A X
A Y
B X
C Y
B Z
B Y
B Z
B Y
A Y
B Y
B Y
B X
A X
B Z
B Y
A Y
B X
B Z
B Y
B X
C Z
C Z
B X
A Y
C Y
C Y
B Y
C Y
B Y
B Y
B Y
B X
B Z
B Z
B Y
B X
B Y
B X
B Y
C Z
C Y
B Z
C Z
C Y
B Y
C X
C Z
B X
C Y
C Y
B Y
C Y
B Z
B Y
B Y
A Y
C Y
C X
A Y
C Y
B X
B Y
C Y
B X
C Y
C Y
C X
C Z
B X
C X
A Y
B X
A Y
B Z
A Z
C Y
A Y
A X
B Y
B Z
A Y
B Y
C Y
A Y
B Y
C X
C Y
C Y
C X
C X
C Y
B X
B Z
C X
B Y
C Y
C Y
C Y
C Z
B Z
C Z
B Z
C X
B Y
A Z
C Z
B Y
B Y
B Y
C Y
B X
B X
B Y
C Y
C X
A Y
C Z
B Z
A Y
B Y
B Z
C Y
B X
C X
A Y
B Y
B Y
C Z
B X
A Z
C Z
B X
C Y
B X
C Y
C X
C Y
C Y
C Y
B Y
B Z
B Z
C Y
B Z
C Y
C Z
B Y
C Y
C Y
C Z
B X
A Y
B Y
B Y
B Y
A Z
B X
C Y
C Y
A Y
C Y
C Y
B X
C X
A Y
B Y
A Y
C Z
A Y
C Z
B Z
A Z
A Y
B X
C Y
B X
C Y
C X
A Y
B Y
B Y
C Z
C Z
B Z
C Y
B Y
B Z
B X
A Z
C Y
C X
B Y
C Z
A Y
B X
C X
C X
B Z
C X
B Z
B Z
A Y
B Y
B X
B Z
C X
B Y
A Y
C Y
C Y
B Y
B Z
C X
B Y
B Y
C Y
A Y
C Z
C Z
B Y
B Y
B X
C Y
B X
B Y
C Y
C Y
B X
B Z
B Y
C Z
A Y
A X
C Y
A Y
B Z
B X
B Z
B Z
B Y
B Y
B Y
A Y
A X
A Y
B Y
A Y
C Y
C Y
C Y
B Y
C Y
C Y
B X
C Y
B Y
A Y
A Y
C Z
B Y
B X
C X
B X
B Y
A Y
B X
B Y
B Z
C Y
A Y
A Z
B X
C Y
C X
B Y
B X
C Y
C Z
C Y
A Y
A X
C Z
C X
A Y
A X
B Y
C X
C X
C Y
C Z
C X
B Z
B Y
A Y
B Y
C Y
C Y
C Y
C Y
C X
B Y
A Y
A Y
C Y
A Y
A Y
C Y
A Y
C X
B X
A Y
A Y
A Y
A Y
B X
C Y
A Y
C Y
B Y
B Y
C Y
B X
C Y
A Y
C Z
A X
B X
C Y
C Y
B Y
A Y
A Y
C Y
C X
B X
B Z
B X
C X
A Y
B Y
B X
B Y
B Z
A Y
B Y
B Z
A Y
C Z
B Y
C X
C Y
A Y
C Z
C Y
B X
B Y
C Y
C Z
A Y
B X
B X
A Y
B Z
B Y
C Z
B X
B X
C Z
A Y
C Z
A Y
C X
B X
C Y
A Y
B Z
B Y
B X
C Z
A Y
B X
C X
C Y
B Y
C Z
C Y
C Y
A Y
C Z
C Y
A Y
B Y
B Y
C Y
A Y
B Y
B Y
B Z
A Y
C Z
A Z
C Z
B X
B Y
C X
A Y
A Y
C Y
A Y
B Y
C X
A X
A Y
B Y
C Y
C X
A Y
A Y
B X
C Y
B Y
C Z
C X
B X
C Y
A X
A Y
A Y
B Y
C Y
C Z
A Y
B Y
C Y
C Y
B X
A Y
B Y
B X
C Y
B Z
C Y
B X
A Y
B Y
C Y
C Z
B Y
C Y
A Z
C Z
B X
B Y
C Y
B Y
A Y
B Y
B X
C Z
C Z
C X
B Y
C Y
C Y
B Y
B Y
A Y
B Z
B X
C Y
B Y
C Y
B Z
C Z
C Z
C Y
B Y
A Y
C X
B X
B X
B Y
C Y
C Y
B Y
B Z
C Y
B X
C Y
C Z
B X
A Y
B X
C Y
C X
A Y
B X
A Y
A Y
C Y
B Y
C Y
B X
C Y
B Y
C Y
B X
C Y
B Y
A Y
A Y
C Z
B X
C Y
C Z
B Y
A X
C X
B X
B X
C Y
B X
C X
B Y
A Y
B Y
C Y
B Y
C Y
C Y
A X
C X
C Y
B Y
B Y
C Y
C Y
A Y
A Y
C Z
C Y
C Y
B X
A Y
C Z
B Y
B Y
B Y
C Z
B Z
B Z
C X
C Y
B Y
B Y
A Y
C Y
C Y
B Y
C Y
A Y
C Y
B Y
C Y
B Z
B Y
A Y
B Y
B X
C Z
C X
C X
A Y
C Z
B Y
B X
A Y
B Y
A X
B Y
B Y
B Y
B X
C Y
C Y
A Y
A Y
B Y
B Z
B Y
B X
B Z
C X
B Y
A Y
B Z
B X
A Y
B Y
A Y
B X
B X
B X
B Y
C X
B X
C X
C Y
B Y
A X
B Y
C Y
B Y
C Y
B Y
B Y
A Y
B Z
B X
B Y
B Y
B Y
A Z
A Y
C Y
C Z
C X
B Z
C Y
B Y
A Y
B X
B Y
C X
B X
B Y
C Y
B Z
C Y
B Z
B Z
B Y
B X
B Y
B Y
B Y
C Y
A Y
A X
C Y
B Y
C Z
B Z
C Y
C X
B X
C X
B X
C Z
A Y
C Y
B Z
C Y
A X
B Z
B Y
B X
B Y
B X
C X
C X
B Z
B Z
C Y
B Y
B X
B X
B Z
A Y
A Y
A Y
B Z
B X
C Z
B Y
B Y
C Y
C Y
B X
B Y
C Y
B Y
B Y
A X
B Z
A Z
B Z
C X
B Z
A Y
B Z
B Y
B Z
A Y
B Y
C Y
C Z
B Y
C X
B X
B Y
A Y
B Z
C Y
C X
C Z
A Y
B Y
C Y
A X
C Z
B X
C Y
A Y
B Y
B Z
A Y
B X
C Y
B Y
C Z
C Y
B Y
B Y
C Y
C Y
C Y
A Y
B Z
C Y
B X
A Y
C Y
A Y
A X
B Z
A Y
B X
B Y
B X
A Y
C Z
B Y
B Z
C X
C Y
C Y
B Z
B Y
C Y
C X
C Y
C Y
B Y
B Y
A Y
B X
C Y
C Y
C Y
C Y
B Y
B Y
C Z
C X
B Y
C Z
A Y
B X
A Y
B Y
C X
B X
B X
B Y
A X
C X
C Y
B Y
C Y
C X
B Y
C Z
B Y
A Y
C Y
C Y
A X
A Y
C Y
A Y
A Y
C Y
A Y
B Y
A Y
B Z
B X
A X
A X
A Z
B Y
B Y
C X
C Y
C X
C X
A Y
B X
B Y
B Y
A X
B X
B Y
B Y
C Y
B Y
C Y
C X
A X
C Y
B Y
C Y
B Y
C Z
B X
B Y
B X
B X
C Y
B Y
A X
C Y
B Y
B X
A Y
B X
A Y
C Y
B Z
B Y
A Y
A Y
B Y
B X
B Y
C Y
B Y
B Y
A Y
A Y
C Y
B Y
C Z
C X
C Z
C X
C Z
A Y
B Y
A Y
C Y
C Y
B Y
C Y
B X
B X
A Y
B Y
B Y
A Y
B X
B Y
B Y
C X
C Y
C X
C Y
C Y
C Y
C X
C Z
B X
B Y
C Y
B Y
B Y
C Y
B X
C Y
B Y
B Y
B Z
B X
A Z
C Y
C Y
A Y
B Y
B Y
A Y
B X
C Y
B Y
B Y
B Z
B X
C Y
B Y
A Y
B Z
C Y
C X
C Y
C Y
B Y
A Y
C Y
C X
A Y
B Y
B Z
B X
C Z
A X
C Y
B Y
B Z
C Y
B Y
B Y
B Y
B Y
C Y
B Y
C Y
B Y
A Y
A Y
A X
B Y
C Y
C Y
C Y
C X
C Z
C X
B X
A Y
C Y
A Y
B Y
C Y
C Z
A Y
B X
B X
A Y
B X
C Y
B Y
B Y
B Y
B Y
C Z
C Y
B Y
B X
A Y
B Z
A Y
C Y
B Z
A Y
B Y
C Y
C Y
B Y
B Y
C Y
A Z
C Y
C X
C Y
C Y
C Y
B X
C Y
A Y
C Y
B X
B Y
C Y
C X
B Y
B Y
A Y
B X
A Y
A Y
B Y
A Y
C Y
B Y
B Z
A Y
C Z
B Y
B Y
B X
A Y
B X
C Y
A Y
A Y
A Y
B Y
B Z
C Y
C Y
B X
A Y
C Y
A Y
B Y
B X
B Y
B Y
C X
B Y
B Y
B Y
B Y
A Y
A Y
C Y
A X
B X
A Y
B X
B Z
B Z
B Z
B Y
B Y
C Y
C Y
C Z
B Z
B Z
C Y
B Y
B Y
C X
C Y
C Y
B Y
A Y
B X
A Y
B Y
A Y
C Y
B Z
A Y
B Y
B Y
B Y
C Z
A Y
A Y
C Y
B Y
C Y
B Y
C Y
B Z
C Y
C X
C Y
C Y
B Y
A X
C Y
A Y
C X
A X
A Y
B Z
C Y
C Y
B Y
C Y
C Y
B Y
C Y
C Z
B Y
A X
C Y
B X
A Y
C Y
B Z
B Y
B Z
A Y
B Y
B Z
C X
B Y
C Y
A X
C X
A X
B Y
B X
C Y
C Y
B Y
B Y
C Y
B Z
C X
A Y
A Y
B Y
B X
B Y
A Y
B Y
B Z
C X
A Y
B X
C Y
C Y
A X
B Y
C Z
B X
B Y
B Y
C Y
B Z
B Y
B Z
A Y
C Y
C Y
B Y
C Z
C Y
A X
A Y
C Y
B Z
A Y
A X
C Y
B X
B X
A Y
B Y
B Z
A Y
C Y
B Y
C Z
C Y
C Y
B Y
C Y
B Z
C Y
B Y
C Z
A X
A Y
A Z
C Y
B Y
B Z
B X
B X
C Y
A X
C Y
B X
B X
C Y
A Z
B X
A Z
B Y
B Y
A Y
B Z
C Y
B Y
C Y
C Y
A Y
C Y
B Y
C Z
C Z
B Y
B X
C Y
C Y
C Y
B Y
C Y
B Z
B Z
A X
C X
B X
C Z
C Y
B X
B Y
A Z
C Y
B Z
B Y
C Y
B X
B Z
B Y
A Y
B Y
B X
C Y
B Y
B Z
C Y
C Z
C Z
C Y
A Y
C X
B Y
A Y
B Z
C Y
A X
C X
C Z
C Z
A Y
B Y
C X
C Y
C Y
B X
C X
C Y
B X
B X
C Y
B Y
B Y
B Y
B Y!';
begin
  insert into input_rps_quest values ( input_rps_quest );
  commit;
end;
/

select * from input_rps_quest;

-----------

create table rps_score_rule (
  action         varchar2(1),
 win_from  varchar2(1),
 lost_from varchar2(1),
 score        number
) ;

insert into rps_score_rule values ('R', 'S', 'P', 1);
insert into rps_score_rule values ('P', 'R', 'S', 2);
insert into rps_score_rule values ('S', 'P', 'R', 3);
commit;

select * from rps_score_rule;

-----------

create table rps_match (
  id number,
 action_play2 varchar2(1),
 action_play1 varchar2(1),
 constraint pk_rps_match primary key (id)
) ;

insert into rps_match
  with matches as (
  select rownum id
       , column_value play
    from table( select apex_string.split(input) from input_rps_quest)
)
select id
     , translate(regexp_substr(play, '\S', 1, 1), 'ABC', 'RPS') as action_play2
     , translate(regexp_substr(play, '\S', 1, 2), 'XYZ', 'RPS') as action_play1
  from matches
;

commit;

select * from rps_match;

----------------------
--PART ONE SOLUTION
with data as (
select id
     , action_play2
     , action_play1
     , case when action_play2 = win_from then 6
            when action_play2 = lost_from then 0
            else 3
       end 
       + score
       as result
  from rps_match p
  join rps_score_rule o
    on p.action_play1 = o.action
)
select sum(result) as score
  from data
;
--11873

------------------------------------------------------------------------------------------------------------


--PART TWO SOLUTION


--adding new column to table rps_match to add the changed rule

alter table rps_match
add  (changed_rule varchar2(1));

--remove all rows and reinsert
truncate table rps_match;

insert into rps_match
  with matches as (
  select rownum id
       , column_value play
    from table( select apex_string.split(input) from input_rps_quest)
)
select id
     , translate(regexp_substr(play, '\S', 1, 1), 'ABC', 'RPS') as action_play2
     , translate(regexp_substr(play, '\S', 1, 2), 'XYZ', 'RPS') as action_play1
     , regexp_substr(play, '\S', 1, 2) as changed_rule
  from matches
;
commit;

select * from rps_match;

----------------

with data as (
select id
     , action_play2
     , action_play1
     , case when changed_rule = 'Z' then 6
            when changed_rule = 'X' then 0
            else 3
       end 
       as final_score
     , case when changed_rule = 'Z' then lost_from
            when changed_rule = 'X' then win_from
            else action_play2
       end 
       as required_action
  from rps_match p
  join rps_score_rule o
    on p.action_play2 = o.action
), score_play1 as (
  select id
       , action_play2
       , required_action
       , o.score + final_score as points 
    from data d
    join rps_score_rule o
      on d.required_action = o.action
)
select sum(points) as score
  from score_play1
;
--12014


--remove the table
drop table input_rps_quest PURGE;
drop table rps_score_rule PURGE;
drop table rps_match PURGE;
